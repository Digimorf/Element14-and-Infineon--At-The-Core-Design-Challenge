/*//////////////////////////////////////////////////////////////////////////////
* File Name:   audio_dac.c
*
* Description: Element14 - At The Core Design Challenge
*              Digimorf, SEGA SG-1000 Emulator lite
*              Audio output driver for PSoC62S4 Pioneer kit
*
* Created on: 17 Apr 2023
*     Author: Francesco De Simone - Digimorf
*
//////////////////////////////////////////////////////////////////////////////*/

// /////////////////////////////////////////////////////////////////////////////
// Includes
// /////////////////////////////////////////////////////////////////////////////
#include "cy_pdl.h"

#include "ipc_shared_memory.h"
#include "audio_dac.h"

// /////////////////////////////////////////////////////////////////////////////
// Private variables
// /////////////////////////////////////////////////////////////////////////////
uint16_t gAudioBuffer[525*2];
volatile uint16_t *gAudioBufferFront,*gAudioBufferBack;

// /////////////////////////////////////////////////////////////////////////////
// Function prototypes
// /////////////////////////////////////////////////////////////////////////////

// /////////////////////////////////////////////////////////////////////////////
// Functions
// /////////////////////////////////////////////////////////////////////////////
void Audio_Init(void)
{
  /*
  * DESCRIPTION: Initialise the audio driver by configuring and starting
  *              basic components such as CTDAC.
  * PARAMETERS:  See above.
  * RETURNS:     Nothing
  */

  gAudioBufferFront =  &gAudioBuffer[0];
  gAudioBufferBack  =  &gAudioBuffer[525];

  *((uint32_t*)gAudioBufferAddr) = (uint32_t)gAudioBufferBack; // Shared location

  Cy_CTDAC_Init(audio_dac_HW, &audio_dac_config);
  Cy_CTDAC_Enable(audio_dac_HW);
}

// /////////////////////////////////////////////////////////////////////////////
